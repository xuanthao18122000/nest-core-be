"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.applyFields = exports.applyQueryFields = exports.applyQueryFieldsParseOutput = void 0;
const rapiq_1 = require("rapiq");
const utils_1 = require("../../utils");
/**
 * Apply parsed fields parameter data on the db query.
 *
 * @param query
 * @param data
 */
/* istanbul ignore next */
function applyQueryFieldsParseOutput(query, data, options = {}) {
    if (data.length === 0) {
        return data;
    }
    query.select(data.map((field) => {
        const alias = (0, utils_1.getAliasForPath)(options.relations, field.path) ||
            options.defaultAlias ||
            options.defaultPath;
        return (0, utils_1.buildKeyWithPrefix)(field.key, alias);
    }));
    return data;
}
exports.applyQueryFieldsParseOutput = applyQueryFieldsParseOutput;
/**
 * Apply raw fields parameter data on the db query.
 *
 * @param query
 * @param data
 * @param options
 */
function applyQueryFields(query, data, options) {
    options = options || {};
    if (options.defaultAlias) {
        options.defaultPath = options.defaultAlias;
    }
    return applyQueryFieldsParseOutput(query, (0, rapiq_1.parseQueryFields)(data, options), options);
}
exports.applyQueryFields = applyQueryFields;
/**
 * Apply raw fields parameter data on the db query.
 *
 * @param query
 * @param data
 * @param options
 */
function applyFields(query, data, options) {
    return applyQueryFields(query, data, options);
}
exports.applyFields = applyFields;
