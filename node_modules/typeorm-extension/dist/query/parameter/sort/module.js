"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.applySort = exports.applyQuerySort = exports.applyQuerySortParseOutput = void 0;
const rapiq_1 = require("rapiq");
const utils_1 = require("../../utils");
// --------------------------------------------------
/**
 * Apply parsed sort parameter data on the db query.
 *
 * @param query
 * @param data
 */
function applyQuerySortParseOutput(query, data) {
    if (data.length === 0) {
        return data;
    }
    const sort = {};
    for (let i = 0; i < data.length; i++) {
        const key = (0, utils_1.buildKeyWithPrefix)(data[i].key, data[i].path);
        sort[key] = data[i].value;
    }
    query.orderBy(sort);
    return data;
}
exports.applyQuerySortParseOutput = applyQuerySortParseOutput;
/**
 * Apply raw sort parameter data on the db query.
 *
 * @param query
 * @param data
 * @param options
 */
function applyQuerySort(query, data, options) {
    options = options || {};
    if (options.defaultAlias) {
        options.defaultPath = options.defaultAlias;
    }
    return applyQuerySortParseOutput(query, (0, rapiq_1.parseQuerySort)(data, options));
}
exports.applyQuerySort = applyQuerySort;
/**
 * Apply raw sort parameter data on the db query.
 *
 * @param query
 * @param data
 * @param options
 */
function applySort(query, data, options) {
    return applyQuerySort(query, data, options);
}
exports.applySort = applySort;
