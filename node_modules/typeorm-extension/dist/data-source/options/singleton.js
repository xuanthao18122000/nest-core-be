"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useDataSourceOptions = exports.hasDataSourceOptions = exports.setDataSourceOptions = void 0;
const module_1 = require("./module");
const instances = {};
const instancePromises = {};
function setDataSourceOptions(options, alias) {
    instances[alias || 'default'] = options;
}
exports.setDataSourceOptions = setDataSourceOptions;
function hasDataSourceOptions(alias) {
    return Object.prototype.hasOwnProperty.call(instances, alias || 'default');
}
exports.hasDataSourceOptions = hasDataSourceOptions;
async function useDataSourceOptions(alias) {
    alias = alias || 'default';
    if (Object.prototype.hasOwnProperty.call(instances, alias)) {
        return instances[alias];
    }
    /* istanbul ignore next */
    if (!Object.prototype.hasOwnProperty.call(instancePromises, alias)) {
        instancePromises[alias] = (0, module_1.buildDataSourceOptions)()
            .catch((e) => {
            if (alias) {
                delete instancePromises[alias];
            }
            throw e;
        });
    }
    instances[alias] = await instancePromises[alias];
    return instances[alias];
}
exports.useDataSourceOptions = useDataSourceOptions;
