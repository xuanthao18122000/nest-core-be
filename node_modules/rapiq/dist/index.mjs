import{createMerger as t,merge as e,isObject as n,mergeArrays as r}from"smob";var o,i;!function(t){t.FILTERS="filters",t.FIELDS="fields",t.PAGINATION="pagination",t.RELATIONS="relations",t.SORT="sort"}(o||(o={})),function(t){t.FILTERS="filter",t.FIELDS="fields",t.PAGINATION="page",t.RELATIONS="include",t.SORT="sort"}(i||(i={}));const l="__DEFAULT__";function a(t,e){return"string"==typeof e?`${e}.${t}`:t}function u(t,e,n){const r=[];if((e=e||{}).transformer){const o=e.transformer(t,r,n);if(void 0!==o&&o)return r}if(Array.isArray(t)){for(let o=0;o<t.length;o++){if(e.transformer){const i=e.transformer(t[o],r,n);if(void 0!==i&&i)return r}if(Array.isArray(t[o]))for(let e=0;e<t[o].length;e++){const i=a(t[o][e],n);r.push(i)}else if("string"!=typeof t[o]){if("object"==typeof t[o]){const i=Object.keys(t[o]);for(let l=0;l<i.length;l++){const s=a(i[l],n),f=u(t[o][i[l]],e,s);0===f.length?r.push(s):r.push(...f)}}}else r.push(a(t[o],n))}return r}if("object"==typeof t&&null!==t){const o=Object.keys(t);for(let i=0;i<o.length;i++){const l=a(o[i],n),s=u(t[o[i]],e,l);0===s.length?r.push(l):r.push(...s)}return r}if("string"==typeof t){const e=a(t,n);return r.push(e),r}return r}function s(t){const e={};for(let n=0;n<t.length;n++){const r=t[n].split(".");let o,i;1===r.length?(o=l,i=t[n]):(i=r.pop(),o=r.join(".")),Object.prototype.hasOwnProperty.call(e,o)||(e[o]=[]),e[o].push(i)}return e}function f(){return f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},f.apply(this,arguments)}function c(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function p(t,e,n){n=n||[];let r={};if((e=e||{}).transformer){const o=e.transformer(t,r,n.join("."));if(void 0!==o&&o)return r}const o=Object.keys(t);for(let i=0;i<o.length;i++){const l=o[i];if(e.transformer){const o=e.transformer(t[l],r,[...n,l].join("."));if(void 0!==o&&o)continue}if("object"==typeof t[l]&&t[l]){r=f({},r,p(t[l],e,[...n,l]));continue}const a=[...n,l].join(".");("boolean"==typeof t[l]||"string"==typeof t[l]||"number"==typeof t[l]||void 0===t[l]||null===t[l]||Array.isArray(t[l]))&&(r[a]=t[l])}return r}function d(t,e,n){if(void 0===e)return t;let r=t.split(".");const o=[];let i=!0;for(;i;){const t=r.shift();if(void 0===t){i=!1;break}if(c(e,t))o.push(e[t]);else{let n=!1;const i=[],l=[...r];for(;l.length>0;){const r=[t,...l].join(".");if(c(e,r)){o.push(e[r]),n=!0;break}{const t=l.pop();t&&i.unshift(t)}}n?r=i:o.push(t)}}return n?o.pop()||t:0===o.length?t:o.join(".")}function h(t){const e=t.split(".");return{name:e.pop(),path:e.length>0?e.join("."):void 0}}function y(t){return void 0===("string"==typeof t?h(t):t).path}function g(t,e){if(void 0===e)return!0;const n="string"==typeof t?h(t):t;return void 0===n.path||e.some((t=>t.key===n.path))}function A(t,e){const n="string"==typeof t?h(t):t;return n.path||e?`${n.path||e}.${n.name}`:n.name}function E(t){if(void 0===t)return[];const e=s(u(t)),n=Object.keys(e);return 1===n.length?e[n[0]]:e}function v(e,n){Array.isArray(e)&&(e=s(e)),Array.isArray(n)&&(n=s(n));const r=t({array:!0,arrayDistinct:!0})({},e,n),o=Object.keys(r);return 1===o.length?r[o[0]]:r}var O,I,N,L;function T(t){return void 0===t?[]:u(t)}function S(t,e){const n=Array.isArray(e)?e:[e],r=u(t);for(let t=0;t<r.length;t++)if(-1!==n.indexOf(r[t]))return!0;return!1}function b(t){if(void 0===t)return{};let e={};return Array.isArray(t)?e[l]=t:e=t,e}function m(t){const e=t.substring(0,1);return e===O.INCLUDE||e===O.EXCLUDE?t.substring(1):t}function R(t){const e={default:[],included:[],excluded:[]};for(let n=0;n<t.length;n++){let r;const o=t[n].substring(0,1);if(o===O.INCLUDE?r=O.INCLUDE:o===O.EXCLUDE&&(r=O.EXCLUDE),r)switch(t[n]=t[n].substring(1),r){case O.INCLUDE:e.included.push(t[n]);break;case O.EXCLUDE:e.excluded.push(t[n])}else e.default.push(t[n])}return e}function j(t){let e=[];if("string"==typeof t)e=t.split(",");else if(Array.isArray(t))for(let n=0;n<t.length;n++)"string"==typeof t[n]&&e.push(t[n]);return e}function P(t){return/^[a-zA-Z_][a-zA-Z0-9_]*$/gu.test(t)}function w(){return w=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},w.apply(this,arguments)}function _(t,r){const o=s(T((r=r||{}).default)),i=s(T(r.allowed)),a=e({},o,i);let u=Object.keys(a);if((void 0!==r.default||void 0!==r.allowed)&&0===u.length)return[];let f={[l]:[]};n(t)?f=t:"string"==typeof t?f={[l]:t}:Array.isArray(t)&&(f={[l]:t}),r.mapping=r.mapping||{};const p=function(t){const e=Object.keys(t),n={};for(let r=0;r<e.length;r++)n[t[e[r]]]=e[r];return n}(r.mapping);0===u.length&&(u=Object.keys(f));const h=[];for(let t=0;t<u.length;t++){const e=u[t];if(!g({path:e},r.relations)&&e!==l)continue;let n=[];c(f,e)?n=j(f[e]):c(p,e)&&c(f,p[e])&&(n=j(f[p[e]]));let s={default:[],included:[],excluded:[]};if(n.length>0){for(let t=0;t<n.length;t++)n[t]=d(A({name:n[t],path:e}),r.mapping,!0);n=c(a,e)?n.filter((t=>-1!==a[e].indexOf(m(t)))):n.filter((t=>P(m(t)))),s=R(n)}0===s.default.length&&c(o,e)&&(s.default=o[e]),0===s.included.length&&0===s.default.length&&c(i,e)&&(s.default=i[e]),s.default=Array.from(new Set([...s.default,...s.included]));for(let t=0;t<s.excluded.length;t++){const e=s.default.indexOf(s.excluded[t]);-1!==e&&s.default.splice(e,1)}if(s.default.length>0)for(let t=0;t<s.default.length;t++){let n;e!==l?n=e:r.defaultPath&&(n=r.defaultPath),h.push(w({key:s.default[t]},n?{path:n}:{}))}}return h}function k(t){return void 0===t?{}:p(t,{transformer:(t,e,n)=>{if(void 0===t)return e[n]=null,!0;if(Array.isArray(t)){const r=[];for(let e=0;e<t.length;e++)null===t[e]&&(t[e]="null"),"number"==typeof t[e]&&(t[e]=`${t[e]}`),"string"==typeof t[e]&&r.push(t[e]);return e[n]=r.join(","),!0}}})}function D(t,n){return e({},t||{},n||{})}function F(t){if("string"==typeof t){const e=(t=t.trim()).toLowerCase();if("true"===e)return!0;if("false"===e)return!1;if("null"===e)return null;if(0===t.length)return t;const n=Number(t);if(!Number.isNaN(n))return n;const r=t.split(",");if(r.length>1)return F(r)}if(Array.isArray(t)){for(let e=0;e<t.length;e++)t[e]=F(t[e]);return t.filter((t=>0===t||null===t||!!t))}return null==t?null:t}function U(t,e,n){if("string"!=typeof e){if(Array.isArray(e)){let r=!1;for(let o=0;o<e.length;o++){const i=U(t,e[o],n);void 0!==i&&(r=!0,e[o]=i)}if(r)return e}}else switch(n){case"start":if(e.substring(0,t.length)===t)return e.substring(t.length);break;case"end":if(e.substring(0-t.length)===t)return e.substring(0,e.length-t.length-1)}}function C(t){"string"==typeof t&&t.includes(N.IN)&&(t=t.split(N.IN));let e=!1,n=U(N.NEGATION,t,"start");return void 0!==n&&(e=!0,t=n),Array.isArray(t)?{value:t,operator:e?I.NOT_IN:I.IN}:(n=U(N.LIKE,t,"start"),void 0!==n?{value:n,operator:e?I.NOT_LIKE:I.LIKE}:(n=U(N.LESS_THAN_EQUAL,t,"start"),void 0!==n?{value:n,operator:I.LESS_THAN_EQUAL}:(n=U(N.LESS_THAN,t,"start"),void 0!==n?{value:n,operator:I.LESS_THAN}:(n=U(N.MORE_THAN_EQUAL,t,"start"),void 0!==n?{value:n,operator:I.GREATER_THAN_EQUAL}:(n=U(N.MORE_THAN,t,"start"),void 0!==n?{value:n,operator:I.GREATER_THAN}:{value:t,operator:e?I.NOT_EQUAL:I.EQUAL})))))}function $(){return $=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},$.apply(this,arguments)}function G(t){return!c(t,"path")||void 0!==t.path&&null!==t.path||delete t.path,t.operator||("string"==typeof t.value?t=$({},t,C(t.value)):t.operator=I.EQUAL,t.value=F(t.value)),t}function H(t,e={}){const n=Object.keys(e||{});if(!t.defaultByElement&&n.length>0)return Object.values(e);if(t.default){const r=p(t.default),o=Object.keys(r),i=[];for(let l=0;l<o.length;l++){const a=h(o[l]);if(t.defaultByElement&&n.length>0){if(c(e,A(a)))continue}if(t.defaultByElement||0===n.length){let e;a.path?e=a.path:t.defaultPath&&(e=t.defaultPath),i.push(G($({},e?{path:e}:{},{key:a.name,value:r[o[l]]})))}}return e?[...Object.values(e),...i]:i}return e?Object.values(e):[]}function x(t,e){if((e=e||{}).mapping=e.mapping||{},e.relations=e.relations||[],void 0!==e.allowed&&(e.allowed=T(e.allowed),0===e.allowed.length))return H(e);if("object"!=typeof t||null===t)return H(e);const{length:n}=Object.keys(t);if(0===n)return H(e);if((void 0===e.allowed||0===e.allowed.length)&&e.default){const t=p(e.default);e.allowed=Object.keys(t)}const r={},o=Object.keys(t);for(let n=0;n<o.length;n++){if(!c(t,o[n]))continue;const i=t[o[n]];if("string"!=typeof i&&"number"!=typeof i&&"boolean"!=typeof i&&null!=i&&!Array.isArray(i))continue;o[n]=d(o[n],e.mapping);const l=h(o[n]);if(void 0===e.allowed&&!P(l.name))continue;if(!g(l,e.relations)&&!y(l))continue;const a=A(l);if(e.allowed&&!S(e.allowed,[o[n],a]))continue;const u=G({key:l.name,value:i});if(e.validate)if(Array.isArray(u.value)){const t=[];for(let n=0;n<u.value.length;n++)e.validate(u.key,u.value[n])&&t.push(u.value[n]);if(u.value=t,0===u.value.length)continue}else if(!e.validate(u.key,u.value))continue;"string"==typeof u.value&&0===u.value.length||(Array.isArray(u.value)&&0===u.value.length||((l.path||e.defaultPath)&&(u.path=l.path||e.defaultPath),r[a]=u))}return H(e,r)}function Q(t,n){return e({},t||{},n||{})}function M(t,e){return void 0!==e.maxLimit&&(void 0===t.limit||t.limit>e.maxLimit)&&(t.limit=e.maxLimit),void 0!==t.limit&&void 0===t.offset&&(t.offset=0),t}function K(t,e){e=e||{};const r={};if(!n(t))return M(r,e);let{limit:o,offset:i}=t;return void 0!==o&&(o=parseInt(o,10),!Number.isNaN(o)&&o>0&&(r.limit=o)),void 0!==i&&(i=parseInt(i,10),!Number.isNaN(i)&&i>=0&&(r.offset=i)),M(r,e)}function X(t){return void 0===t?[]:u(t)}function z(t,e){return r(t||[],e||[],!0)}function Z(t){for(let e=0;e<t.length;e++){const n=t[e].split(".");for(;n.length>0;)if(n.pop(),n.length>0){const e=n.join(".");-1===t.indexOf(e)&&t.unshift(e)}}return t}function B(t,e={}){if(e=e||{},Array.isArray(e.allowed)&&0===e.allowed.length)return[];e.mapping=e.mapping||{},e.pathMapping=e.pathMapping||{},void 0===e.includeParents&&(e.includeParents=!0);let n=[];if("string"==typeof t)n=t.split(",");else if(Array.isArray(t))for(let e=0;e<t.length;e++)"string"==typeof t[e]&&n.push(t[e]);if(0===n.length)return[];if(Object.keys(e.mapping).length>0)for(let t=0;t<n.length;t++)n[t]=d(n[t],e.mapping);if(n=e.allowed?n.filter((t=>S(e.allowed,t))):n.filter((t=>function(t){return/^[a-zA-Z0-9_-]+([.]*[a-zA-Z0-9_-])*$/gu.test(t)}(t))),e.includeParents)if(Array.isArray(e.includeParents)){const t=n.filter((t=>t.includes(".")&&e.includeParents.filter((e=>t.startsWith(e))).length>0));n.unshift(...Z(t))}else n=Z(n);return n=Array.from(new Set(n)),n.map((t=>{const n=t.split(".");let r;return r=e.pathMapping&&c(e.pathMapping,t)?e.pathMapping[t]:n.pop(),{key:t,value:r}}))}function q(t){return void 0===t?[]:"string"==typeof t?[t]:u(t,{transformer:(t,e,n)=>{if("string"==typeof t&&n&&(t===L.ASC||t===L.DESC))return t===L.DESC?e.push(`-${n}`):e.push(n),!0}})}function W(t,e){return r(t||[],e||[],!0)}function J(t){let e=L.ASC;return"-"===t.substring(0,1)&&(e=L.DESC,t=t.substring(1)),{direction:e,value:t}}function V(){return V=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},V.apply(this,arguments)}function Y(t){return!!Array.isArray(t)&&(t.length>0&&Array.isArray(t[0]))}function tt(t){if(t.default){const e=[],n=p(t.default),r=Object.keys(n);for(let o=0;o<r.length;o++){const i=h(r[o]);let l;i.path?l=i.path:t.defaultPath&&(l=t.defaultPath),e.push(V({key:i.name},l?{path:l}:{},{value:n[r[o]]}))}return e}return[]}function et(t,e){if(void 0!==(e=e||{}).allowed){if(0===T(e.allowed).length)return tt(e)}if(e.mapping=e.mapping||{},"string"!=typeof t&&!Array.isArray(t)&&!n(t))return tt(e);if(void 0===e.allowed&&e.default){const t=p(e.default);e.allowed=Object.keys(t)}let r=[];if("string"==typeof t&&(r=t.split(",")),Array.isArray(t)&&(r=t.filter((t=>"string"==typeof t))),"object"==typeof t&&null!==t){const e=Object.keys(t);for(let n=0;n<e.length;n++){if(!c(t,e[n])||"string"!=typeof e[n]||"string"!=typeof t[e[n]])continue;const o="desc"===t[e[n]].toLowerCase()?"-":"";r.push(o+e[n])}}const o={};let i=!1;for(let t=0;t<r.length;t++){const{value:n,direction:l}=J(r[t]);r[t]=n;const a=d(r[t],e.mapping),u=h(a);if(void 0===e.allowed&&!P(u.name))continue;if(!g(u,e.relations)&&!y(u))continue;const s=A(u);if(void 0!==e.allowed&&!Y(e.allowed)&&!S(e.allowed,[a,s]))continue;let f;i=!0,u.path?f=u.path:e.defaultPath&&(f=e.defaultPath),o[s]=V({key:u.name},f?{path:f}:{},{value:l})}if(!i)return tt(e);if(Y(e.allowed)){t:for(let t=0;t<e.allowed.length;t++){const n=[],r=T(e.allowed[t]);for(let t=0;t<r.length;t++){let i,l=r[t];const u=l.split(".");if(u.length>1?i=u.pop():(i=l,l=a(i,e.defaultPath)),!c(o,i)&&!c(o,l))continue t;{const t=c(o,i)?o[i]:o[l];n.push(t)}}return n}return[]}return Object.values(o)}function nt(t){if(!t)return"";const e={};return void 0===t[o.FIELDS]&&void 0===t[i.FIELDS]||(e[i.FIELDS]=v(E(t[o.FIELDS]),E(t[i.FIELDS]))),void 0===t[o.FILTERS]&&void 0===t[i.FILTERS]||(e[i.FILTERS]=D(k(t[o.FILTERS]),k(t[i.FILTERS]))),void 0===t[o.PAGINATION]&&void 0===t[i.PAGINATION]||(e[i.PAGINATION]=Q(t[o.PAGINATION],t[i.PAGINATION])),void 0===t[o.RELATIONS]&&void 0===t[i.RELATIONS]||(e[i.RELATIONS]=z(X(t[o.RELATIONS]),X(t[i.RELATIONS]))),void 0===t[o.SORT]&&void 0===t[i.SORT]||(e[i.SORT]=W(q(t[o.SORT]),q(t[i.SORT]))),function(t,e=!0){if(null==t)return"";if("string"==typeof t)return t;const n=[],r=Object.keys(t);for(let e=0;e<r.length;e++)if(Object.prototype.hasOwnProperty.call(t,r[e])){let o=t[r[e]];if(o&&"object"==typeof o&&o.constructor===Array&&(o=o.join(",")),o&&"object"==typeof o&&o.constructor===Object){const t=Object.keys(o);for(let i=0;i<t.length;i++){let l=o[t[i]];l&&"object"==typeof l&&l.constructor===Array&&(l=l.join(",")),n.push(`${encodeURIComponent(`${r[e]}[${t[i]}]`)}=${encodeURIComponent(l)}`)}continue}n.push(`${encodeURIComponent(r[e])}=${encodeURIComponent(o)}`)}return(e?"?":"")+n.join("&")}(e)}function rt(){return rt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},rt.apply(this,arguments)}function ot(t,e,n,r){switch(t){case o.FIELDS:case i.FIELDS:return _(e,rt({},it(n),r?{relations:r}:{}));case o.FILTERS:case i.FILTERS:return x(e,rt({},it(n),r?{relations:r}:{}));case o.PAGINATION:case i.PAGINATION:return K(e,rt({},it(n)));case o.RELATIONS:case i.RELATIONS:return B(e,rt({},it(n)));default:return et(e,rt({},it(n),r?{relations:r}:{}))}}function it(t){return"boolean"==typeof t||void 0===t?{}:t}function lt(t){return n(t)?t:{}}function at(t){return"boolean"!=typeof t||t}function ut(t,e={}){const n=t=>(void 0!==t&&e.defaultPath&&(t.defaultPath=e.defaultPath),t||{}),r={};let l;(e=e||{}).defaultPath&&(r.defaultPath=e.defaultPath);const a=[o.RELATIONS,o.FIELDS,o.FILTERS,o.PAGINATION,o.SORT];for(let u=0;u<a.length;u++){const s=a[u];switch(s){case o.RELATIONS:{const n=t[o.RELATIONS]||t[i.RELATIONS];n&&at(e[o.RELATIONS])&&(l=ot(s,n,lt(e[o.RELATIONS])),r[o.RELATIONS]=l);break}case o.FIELDS:{const a=t[o.FIELDS]||t[i.FIELDS];a&&at(e[o.FIELDS])&&(r[o.FIELDS]=ot(s,a,n(lt(e[o.FIELDS])),l));break}case o.FILTERS:{const a=t[o.FILTERS]||t[i.FILTERS];a&&at(e[o.FILTERS])&&(r[o.FILTERS]=ot(s,a,n(lt(e[o.FILTERS])),l));break}case o.PAGINATION:{const n=t[o.PAGINATION]||t[i.PAGINATION];n&&at(e[o.PAGINATION])&&(r[o.PAGINATION]=ot(s,n,lt(e[o.PAGINATION]),l));break}case o.SORT:{const a=t[o.SORT]||t[i.SORT];a&&at(e[o.SORT])&&(r[o.SORT]=ot(s,a,n(lt(e[o.SORT])),l));break}}}return r}!function(t){t.INCLUDE="+",t.EXCLUDE="-"}(O||(O={})),function(t){t.EQUAL="$eq",t.NOT_EQUAL="$ne",t.LIKE="$l",t.NOT_LIKE="$nl",t.LESS_THAN_EQUAL="$lte",t.LESS_THAN="$lt",t.GREATER_THAN_EQUAL="$gte",t.GREATER_THAN="$gt",t.IN="$in",t.NOT_IN="$nin"}(I||(I={})),function(t){t.NEGATION="!",t.LIKE="~",t.LESS_THAN_EQUAL="<=",t.LESS_THAN="<",t.MORE_THAN_EQUAL=">=",t.MORE_THAN=">",t.IN=","}(N||(N={})),function(t){t.ASC="ASC",t.DESC="DESC"}(L||(L={}));export{l as DEFAULT_ID,O as FieldOperator,I as FilterComparisonOperator,N as FilterInputOperatorValue,o as Parameter,L as SortDirection,i as URLParameter,b as buildFieldDomainRecords,nt as buildQuery,E as buildQueryFields,k as buildQueryFilters,lt as buildQueryParameterOptions,X as buildQueryRelations,q as buildQuerySort,T as flattenParseAllowedOption,S as isPathCoveredByParseAllowedOption,at as isQueryParameterEnabled,P as isValidFieldName,v as mergeQueryFields,D as mergeQueryFilters,Q as mergeQueryPagination,z as mergeQueryRelations,W as mergeQuerySort,j as parseFieldsInput,C as parseFilterValue,ut as parseQuery,_ as parseQueryFields,x as parseQueryFilters,K as parseQueryPagination,ot as parseQueryParameter,B as parseQueryRelations,et as parseQuerySort,m as removeFieldInputOperator,R as transformFieldsInput,F as transformFilterValue};
//# sourceMappingURL=index.mjs.map
