{"version":3,"file":"index.mjs","sources":["../src/utils/array.ts","../src/utils/has-own-property.ts","../src/utils/check.ts","../src/utils/cut.ts","../src/utils/options.ts","../src/module.ts"],"sourcesContent":["/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nexport function mergeArrays(\n    first: any[],\n    second: any[],\n    arrayDistinct: boolean,\n) {\n    if (arrayDistinct) {\n        return [...new Set(first.concat(second))];\n    }\n\n    return first.concat(second);\n}\n","/*\n * Copyright (c) 2021.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function hasOwnProperty<X extends {}, Y extends PropertyKey>(obj: X, prop: Y): obj is X & Record<Y, unknown> {\n    return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport { hasOwnProperty } from './has-own-property';\n\nexport function isObject(item: unknown) : item is Record<string, any> {\n    return (\n        !!item &&\n        typeof item === 'object' &&\n        !Array.isArray(item)\n    );\n}\n\nexport function isObjectDeeperThan(value: unknown, depth: number) {\n    if (depth <= 0) {\n        return isObject(value);\n    }\n\n    if (typeof value !== 'object') {\n        return false;\n    }\n\n    const nextDepth = depth - 1;\n    const keys = Object.keys(value);\n    for (let i = 0; i < keys.length; i++) {\n        if (\n            hasOwnProperty(value, keys[i]) &&\n            isObjectDeeperThan(value[keys[i]], nextDepth)\n        ) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isSafeObject(object: Record<string, any>) : boolean {\n    try {\n        JSON.stringify(object);\n        return true;\n    } catch (e) {\n        return false;\n    }\n}\n\nexport function isSafeKey(key: string) : boolean {\n    return key !== '__proto__' &&\n        key !== 'prototype' &&\n        key !== 'constructor';\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport { isObject } from './check';\n\nexport function cutObject<T extends Record<string, any>>(input: T, depth: number) : T {\n    if (depth < 0) {\n        return {} as T;\n    }\n\n    const value = { ...input };\n    const keys : (keyof T)[] = Object.keys(value);\n\n    for (let i = 0; i < keys.length; i++) {\n        if (isObject(value[keys[i]])) {\n            if (depth === 0) {\n                value[keys[i]] = {} as T[keyof T];\n            } else {\n                value[keys[i]] = cutObject(value[keys[i]], depth - 1);\n            }\n        }\n    }\n\n    return value;\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport { Options } from '../type';\n\nexport function buildOptions(options?: Partial<Options>) {\n    options = options || {};\n\n    options.array = options.array ?? true;\n    options.arrayDistinct = options.arrayDistinct ?? false;\n    options.priority = options.priority || 'left';\n\n    return options as Options;\n}\n","/*\n * Copyright (c) 2022.\n * Author Peter Placzek (tada5hi)\n * For the full copyright and license information,\n * view the LICENSE file that was distributed with this source code.\n */\n\nimport { Merger, MergerResult, Options } from './type';\nimport {\n    buildOptions,\n    hasOwnProperty,\n    isObject,\n    isSafeKey,\n    isSafeObject,\n    mergeArrays,\n} from './utils';\n\nexport function baseMerger<A extends Record<string, any>, B extends Record<string, any>>(\n    options: Options,\n    target: A,\n    ...sources: B[]\n) : MergerResult<A, B> {\n    if (!sources.length) return target as MergerResult<A, B>;\n\n    const source = sources.shift();\n\n    if (\n        isObject(target) &&\n        isObject(source)\n    ) {\n        const keys = Object.keys(source);\n        for (let i = 0; i < keys.length; i++) {\n            const key : string = keys[i];\n\n            if (!isSafeKey(key)) {\n                continue;\n            }\n\n            if (hasOwnProperty(target, key)) {\n                if (options.strategy) {\n                    const applied = options.strategy(target, key, source[key]);\n                    if (typeof applied !== 'undefined') {\n                        continue;\n                    }\n                }\n\n                if (!isSafeObject(source[key])) {\n                    continue;\n                }\n\n                if (\n                    isObject(target[key]) &&\n                    isObject(source[key])\n                ) {\n                    baseMerger(options, target[key], source[key]);\n\n                    continue;\n                }\n\n                if (\n                    options.array &&\n                    Array.isArray(target[key]) &&\n                    Array.isArray(source[key])\n                ) {\n                    switch (options.priority) {\n                        case 'left':\n                            Object.assign(target, {\n                                [key]: mergeArrays(target[key], source[key], options.arrayDistinct),\n                            });\n                            break;\n                        case 'right':\n                            Object.assign(target, {\n                                [key]: mergeArrays(source[key], target[key], options.arrayDistinct),\n                            });\n                            break;\n                    }\n\n                    continue;\n                }\n\n                if (options.priority === 'right') {\n                    Object.assign(target, { [key]: source[key] });\n                }\n            } else {\n                Object.assign(target, { [key]: source[key] });\n            }\n        }\n    }\n\n    return baseMerger(options, target, ...sources);\n}\n\nexport function createMerger(input?: Partial<Options>) : Merger {\n    const options = buildOptions(input);\n\n    return <A extends Record<string, any>, B extends Record<string, any>>(\n        target: A,\n        ...sources: B[]\n    ) => baseMerger(options, target, ...sources);\n}\n\nexport const merge = createMerger();\n"],"names":["mergeArrays","first","second","arrayDistinct","Set","concat","hasOwnProperty","obj","prop","Object","prototype","call","isObject","item","Array","isArray","isObjectDeeperThan","value","depth","nextDepth","keys","i","length","isSafeObject","object","JSON","stringify","e","isSafeKey","key","_extends","cutObject","input","buildOptions","options","array","priority","baseMerger","target","sources","source","shift","strategy","assign","createMerger","merge"],"mappings":"AAOO,SAASA,EACZC,EACAC,EACAC,GAEA,OAAIA,EACO,IAAI,IAAIC,IAAIH,EAAMI,OAAOH,KAG7BD,EAAMI,OAAOH,EACxB,CCTO,SAASI,EAAoDC,EAAQC,GACxE,OAAOC,OAAOC,UAAUJ,eAAeK,KAAKJ,EAAKC,EACrD,CCDO,SAASI,EAASC,GACrB,QACMA,GACc,iBAATA,IACNC,MAAMC,QAAQF,EAEvB,CAEO,SAASG,EAAmBC,EAAgBC,GAC/C,GAAIA,GAAS,EACT,OAAON,EAASK,GAGpB,GAAqB,iBAAVA,EACP,OAAO,EAGX,MAAME,EAAYD,EAAQ,EACpBE,EAAOX,OAAOW,KAAKH,GACzB,IAAK,IAAII,EAAI,EAAGA,EAAID,EAAKE,OAAQD,IAC7B,GACIf,EAAeW,EAAOG,EAAKC,KAC3BL,EAAmBC,EAAMG,EAAKC,IAAKF,GAEnC,OAAO,EAIf,OAAO,CACX,CAEO,SAASI,EAAaC,GACzB,IAEI,OADAC,KAAKC,UAAUF,IACR,CAGX,CAFE,MAAOG,GACL,OAAO,CACX,CACJ,CAEO,SAASC,EAAUC,GACtB,MAAe,cAARA,GACK,cAARA,GACQ,gBAARA,CACR,CChDC,SAAAC,uMAIM,SAASC,EAAyCC,EAAUd,GAC/D,GAAIA,EAAQ,EACR,MAAO,GAGX,MAAMD,EAAQa,EAAKE,CAAAA,EAAAA,GACbZ,EAAqBX,OAAOW,KAAKH,GAEvC,IAAK,IAAII,EAAI,EAAGA,EAAID,EAAKE,OAAQD,IACzBT,EAASK,EAAMG,EAAKC,OAEhBJ,EAAMG,EAAKC,IADD,IAAVH,EACiB,CAAA,EAEAa,EAAUd,EAAMG,EAAKC,IAAKH,EAAQ,IAK/D,OAAOD,CACX,CCnBO,SAASgB,EAAaC,GAGTA,IAAAA,EACQA,EAGxB,OANAA,EAAUA,GAAW,IAEbC,MAAqB,OAAbD,EAAAA,EAAQC,QAARD,EAChBA,EAAQ/B,cAAqC,OAArB+B,EAAAA,EAAQ/B,gBAAR+B,EACxBA,EAAQE,SAAWF,EAAQE,UAAY,OAEhCF,CACX,CCAO,SAASG,EACZH,EACAI,KACGC,GAEH,IAAKA,EAAQjB,OAAQ,OAAOgB,EAE5B,MAAME,EAASD,EAAQE,QAEvB,GACI7B,EAAS0B,IACT1B,EAAS4B,GACX,CACE,MAAMpB,EAAOX,OAAOW,KAAKoB,GACzB,IAAK,IAAInB,EAAI,EAAGA,EAAID,EAAKE,OAAQD,IAAK,CAClC,MAAMQ,EAAeT,EAAKC,GAE1B,GAAKO,EAAUC,GAIf,GAAIvB,EAAegC,EAAQT,GAAM,CAC7B,GAAIK,EAAQQ,SAAU,CAElB,QAAuB,IADPR,EAAQQ,SAASJ,EAAQT,EAAKW,EAAOX,IAEjD,QAEP,CAED,IAAKN,EAAaiB,EAAOX,IACrB,SAGJ,GACIjB,EAAS0B,EAAOT,KAChBjB,EAAS4B,EAAOX,IAClB,CACEQ,EAAWH,EAASI,EAAOT,GAAMW,EAAOX,IAExC,QACH,CAED,GACIK,EAAQC,OACRrB,MAAMC,QAAQuB,EAAOT,KACrBf,MAAMC,QAAQyB,EAAOX,IACvB,CACE,OAAQK,EAAQE,UACZ,IAAK,OACD3B,OAAOkC,OAAOL,EAAQ,CAClBT,CAACA,GAAM7B,EAAYsC,EAAOT,GAAMW,EAAOX,GAAMK,EAAQ/B,iBAEzD,MACJ,IAAK,QACDM,OAAOkC,OAAOL,EAAQ,CAClBT,CAACA,GAAM7B,EAAYwC,EAAOX,GAAMS,EAAOT,GAAMK,EAAQ/B,iBAKjE,QACH,CAEwB,UAArB+B,EAAQE,UACR3B,OAAOkC,OAAOL,EAAQ,CAAET,CAACA,GAAMW,EAAOX,UAG1CpB,OAAOkC,OAAOL,EAAQ,CAAET,CAACA,GAAMW,EAAOX,IAE9C,CACH,CAED,OAAOQ,EAAWH,EAASI,KAAWC,EAC1C,CAEO,SAASK,EAAaZ,GACzB,MAAME,EAAUD,EAAaD,GAE7B,MAAO,CACHM,KACGC,IACFF,EAAWH,EAASI,KAAWC,EACxC,CAEO,MAAMM,EAAQD"}